<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#667eea" />
  <title>TaskMaster Pro - AI Study Assistant</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ“</text></svg>" />
</head>
<body>
  <!-- iOS Haptic Trigger (hidden) -->
  <input id="haptic-trigger" style="display:none;" type="checkbox" />
  <label for="haptic-trigger" id="haptic-label" style="display:none;"></label>

  <!-- Floating App Header -->
  <header class="app-header glass-surface">
    <div class="header-wrapper">
      <div class="app-logo">
        <span aria-hidden="true" class="logo-emoji"><ion-icon name="school-outline"></ion-icon></span>
        <span class="logo-title">TaskMaster Pro</span>
      </div>
      <div class="header-actions">
        <select aria-label="Language" class="header-control" id="lang-selector">
          <option value="en">EN</option>
          <option value="si">à·ƒà·’à¶‚</option>
        </select>
        <button aria-label="Toggle reduced motion" aria-pressed="false" class="header-control" id="reduce-motion-btn" title="Reduced Motion">
          <ion-icon name="film-outline"></ion-icon>
        </button>
        <button aria-label="Toggle reduced transparency" aria-pressed="false" class="header-control" id="reduce-transparency-btn" title="Reduced Transparency">
          <ion-icon name="sparkles-outline"></ion-icon>
        </button>
        <button aria-label="Toggle theme" class="header-control theme-toggle" id="theme-btn">
          <ion-icon id="theme-icon" name="moon-outline"></ion-icon>
        </button>
      </div>
    </div>
  </header>

  <!-- Main App Content -->
  <main class="app-main">
    <div id="aria-live" aria-live="polite" aria-atomic="true" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;"></div>

    <!-- TAB 1: Tasks Section -->
    <section id="view-tasks" class="app-view" role="tabpanel" aria-labelledby="tab-tasks">
      <div class="view-header">
        <h2 class="view-title" id="title-tasks"><ion-icon aria-hidden="true" name="create-outline"></ion-icon> My Tasks</h2>
        <button class="btn-primary" id="btn-add-task"><span class="sr-only">Add</span> <ion-icon aria-hidden="true" name="add-outline"></ion-icon> New Task</button>
      </div>
      <div class="tasks-wrapper glass-surface">
        <div id="tasks-list" class="tasks-grid"></div>
      </div>
    </section>

    <!-- TAB 2: Generator Section (Flashcards) -->
    <section id="view-generator" class="app-view active-view" role="tabpanel" aria-labelledby="tab-generator">
      <div class="view-header">
        <h2 class="view-title" id="title-generator"><ion-icon aria-hidden="true" name="albums-outline"></ion-icon> Flashcard Generator</h2>
      </div>
      <div class="generator-panel glass-surface">
        <div class="input-group">
          <label class="input-label" for="fc-subject">Subject</label>
          <select class="input-field" id="fc-subject">
            <option value="Chemistry">Chemistry</option>
            <option value="Physics">Physics</option>
            <option value="Biology">Biology</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Computer Science">Computer Science</option>
          </select>
        </div>
        <div class="input-group">
          <label class="input-label" for="fc-topic">Topic</label>
          <input class="input-field" id="fc-topic" type="text" placeholder="e.g., S-block elements, Newton's Laws" />
        </div>
        <div class="input-group">
          <label class="input-label" for="fc-count">Number of Cards</label>
          <select class="input-field" id="fc-count">
            <option value="5">5 Cards</option>
            <option value="10">10 Cards</option>
            <option value="15">15 Cards</option>
            <option value="20">20 Cards</option>
          </select>
        </div>
        <button class="btn-primary btn-full" id="btn-generate"><ion-icon aria-hidden="true" name="sparkles-outline"></ion-icon> Generate with AI</button>
        <div class="error-message" id="generator-error" role="alert"></div>
      </div>
      <div id="cards-grid" class="flashcards-grid"></div>
    </section>

    <!-- TAB 3: AI Chat Section -->
    <section id="view-chat" class="app-view" role="tabpanel" aria-labelledby="tab-chat">
      <div class="chat-panel glass-surface">
        <div class="chat-top">
          <h2 class="view-title" id="title-chat"><ion-icon aria-hidden="true" name="chatbubble-ellipses-outline"></ion-icon> AI Study Assistant</h2>
          <select class="input-field" id="chat-subject" aria-label="Select subject for chat">
            <option value="General">General</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Physics">Physics</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Biology">Biology</option>
          </select>
        </div>
        <div id="chat-messages" class="chat-messages">
          <div class="chat-msg bot-msg">
            <div class="msg-avatar" aria-hidden="true"><ion-icon name="sparkles-outline"></ion-icon></div>
            <div class="msg-bubble">Hello! I'm your AI study assistant. Ask me anything about your subjects!</div>
          </div>
        </div>
        <div class="chat-bottom">
          <textarea id="chat-input" class="chat-textarea" rows="2" placeholder="Ask a question or describe a problem..."></textarea>
          <button id="btn-send" class="btn-send-chat" aria-label="Send">
            <ion-icon name="send-outline"></ion-icon>
          </button>
        </div>
      </div>
    </section>

    <!-- TAB 4: Timer Section (Pomodoro) -->
    <section id="view-timer" class="app-view" role="tabpanel" aria-labelledby="tab-timer">
      <div class="timer-panel glass-surface">
        <div class="timer-visual">
          <svg class="timer-svg" viewBox="0 0 200 200">
            <circle class="timer-track" cx="100" cy="100" r="85"></circle>
            <circle class="timer-path" id="timer-circle" cx="100" cy="100" r="85"></circle>
          </svg>
          <div class="timer-center">
            <div id="timer-text" class="timer-text">25:00</div>
            <div class="timer-status">Focus Session</div>
          </div>
        </div>
        <div class="timer-buttons">
          <button id="btn-timer-start" class="btn-timer">
            <span id="timer-btn-icon"><ion-icon name="play-outline"></ion-icon></span> <span id="timer-btn-text">Start</span>
          </button>
          <button id="btn-timer-reset" class="btn-timer btn-secondary"><ion-icon aria-hidden="true" name="refresh-outline"></ion-icon> Reset</button>
        </div>
        <div class="timer-details">
          <div class="timer-detail-item">
            <div id="timer-round" class="detail-value">1</div>
            <div class="detail-label">Current Round</div>
          </div>
          <div class="timer-detail-item">
            <div id="timer-completed" class="detail-value">0</div>
            <div class="detail-label">Sessions Done</div>
          </div>
        </div>
      </div>
    </section>

    <!-- TAB 5: Stats Section -->
    <section id="view-stats" class="app-view" role="tabpanel" aria-labelledby="tab-stats">
      <div class="view-header">
        <h2 class="view-title" id="title-stats"><ion-icon aria-hidden="true" name="stats-chart-outline"></ion-icon> Your Progress</h2>
      </div>
      <div class="stats-container">
        <div class="stat-box glass-surface">
          <div class="stat-emoji" aria-hidden="true"><ion-icon name="checkmark-done-circle-outline"></ion-icon></div>
          <div id="stat-tasks" class="stat-num">0</div>
          <div class="stat-desc">Tasks Completed</div>
        </div>
        <div class="stat-box glass-surface">
          <div class="stat-emoji" aria-hidden="true"><ion-icon name="layers-outline"></ion-icon></div>
          <div id="stat-cards" class="stat-num">0</div>
          <div class="stat-desc">Cards Learned</div>
        </div>
        <div class="stat-box glass-surface">
          <div class="stat-emoji" aria-hidden="true"><ion-icon name="stopwatch-outline"></ion-icon></div>
          <div id="stat-hours" class="stat-num">0h</div>
          <div class="stat-desc">Study Time</div>
        </div>
        <div class="stat-box glass-surface">
          <div class="stat-emoji" aria-hidden="true"><ion-icon name="flame-outline"></ion-icon></div>
          <div id="stat-streak" class="stat-num">0</div>
          <div class="stat-desc">Day Streak</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Floating Navigation -->
  <nav class="bottom-dock glass-surface" role="tablist" aria-label="Main navigation">
    <button id="tab-tasks" class="dock-btn" role="tab" aria-controls="view-tasks" aria-label="Tasks" aria-selected="false">
      <span class="dock-emoji" aria-hidden="true"><ion-icon name="create-outline"></ion-icon></span>
      <span class="dock-name">Tasks</span>
      <span class="indicator" aria-hidden="true"></span>
    </button>
    <button id="tab-generator" class="dock-btn active" role="tab" aria-controls="view-generator" aria-label="Generator" aria-selected="true">
      <span class="dock-emoji" aria-hidden="true"><ion-icon name="sparkles-outline"></ion-icon></span>
      <span class="dock-name">Generator</span>
      <span class="indicator" aria-hidden="true"></span>
    </button>
    <button id="tab-chat" class="dock-btn" role="tab" aria-controls="view-chat" aria-label="Chat" aria-selected="false">
      <span class="dock-emoji" aria-hidden="true"><ion-icon name="chatbubble-ellipses-outline"></ion-icon></span>
      <span class="dock-name">Chat</span>
      <span class="indicator" aria-hidden="true"></span>
    </button>
    <button id="tab-timer" class="dock-btn" role="tab" aria-controls="view-timer" aria-label="Timer" aria-selected="false">
      <span class="dock-emoji" aria-hidden="true"><ion-icon name="timer-outline"></ion-icon></span>
      <span class="dock-name">Timer</span>
      <span class="indicator" aria-hidden="true"></span>
    </button>
    <button id="tab-stats" class="dock-btn" role="tab" aria-controls="view-stats" aria-label="Stats" aria-selected="false">
      <span class="dock-emoji" aria-hidden="true"><ion-icon name="stats-chart-outline"></ion-icon></span>
      <span class="dock-name">Stats</span>
      <span class="indicator" aria-hidden="true"></span>
    </button>
  </nav>

  <!-- Task Creation Modal -->
  <div id="task-modal" class="app-modal">
    <div class="modal-backdrop"></div>
    <div class="modal-container glass-surface" role="dialog" aria-modal="true" aria-labelledby="task-modal-title" aria-describedby="task-modal-desc">
      <div class="modal-top">
        <h3 id="task-modal-title">Create New Task</h3>
        <button class="modal-x" aria-label="Close modal" id="modal-close">Ã—</button>
      </div>
      <div id="task-modal-desc" class="modal-mid">
        <div class="input-group">
          <label class="input-label" for="inp-task-title">Task Title</label>
          <input class="input-field" id="inp-task-title" type="text" placeholder="Enter task title" required />
        </div>
        <div class="input-group">
          <label class="input-label" for="inp-task-desc">Description (Optional)</label>
          <textarea class="input-field" id="inp-task-desc" rows="3" placeholder="Add details..."></textarea>
        </div>
        <div class="input-group">
          <label class="input-label" for="inp-task-subj">Subject</label>
          <select class="input-field" id="inp-task-subj">
            <option value="general">General</option>
            <option value="chemistry">Chemistry</option>
            <option value="physics">Physics</option>
            <option value="biology">Biology</option>
            <option value="mathematics">Mathematics</option>
            <option value="computer-science">Computer Science</option>
          </select>
        </div>
        <div class="input-group">
          <label class="input-label" for="inp-task-priority">Priority</label>
          <select class="input-field" id="inp-task-priority">
            <option value="low">Low Priority</option>
            <option value="medium" selected>Medium Priority</option>
            <option value="high">High Priority</option>
          </select>
        </div>
      </div>
      <div class="modal-bot">
        <button class="btn-secondary modal-cancel">Cancel</button>
        <button id="btn-save-task" class="btn-primary">Save Task</button>
      </div>
    </div>
  </div>

  <!-- Loading Spinner Overlay -->
  <div id="loader-overlay" class="loader-screen" aria-live="polite" aria-busy="false">
    <div class="loader-spin" role="status" aria-label="Loading"></div>
  </div>

  <!-- AI Loading Indicator -->
  <div id="loading-indicator" class="loading-indicator" aria-live="polite" aria-busy="false">
    <div class="spinner"></div>
    <p>Generating with AI...</p>
  </div>

  <!-- Ionicons and App Scripts -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script src="script.js"></script>
</body>
</html>
