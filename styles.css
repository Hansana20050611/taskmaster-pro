/* ================================================
   TaskMaster Pro - Ultra-Modern CSS
   iOS 18 + HyperOS 3 Glassmorphism Design
   Stabilized dock, motion, accessibility, and mobile layout
   Enhanced Ionicons Support
================================================ */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

/* CSS Custom Properties */
:root {
  /* Primary Colors */
  --color-primary: #667eea;
  --color-secondary: #764ba2;
  --color-success: #10b981;
  --color-danger: #ef4444;
  --color-warning: #f59e0b;
  --color-info: #3b82f6;
  
  /* Glassmorphism */
  --glass-bg: rgba(255, 255, 255, 0.08);
  --glass-border: rgba(255, 255, 255, 0.16);
  --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
  --glass-blur: blur(24px);
  
  /* Text Colors - Dark Theme */
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.8);
  --text-tertiary: rgba(255, 255, 255, 0.6);
  
  /* Background */
  --bg-base: #0f172a;
  
  /* Spacing */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 0.75rem;
  --space-lg: 1rem;
  --space-xl: 1.5rem;
  
  /* Layout */
  --dock-height: 72px;
  --dock-safe-bottom: env(safe-area-inset-bottom, 0px);
  --header-height: 72px;
  
  /* Motion */
  --transition-fast: 120ms ease;
  --transition-med: 220ms ease;
  --transition-slow: 360ms ease;
}

html, body {
  height: 100%;
  background: var(--bg-base);
  color: var(--text-primary);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  -webkit-text-size-adjust: 100%;
}

/* Prefer color scheme */
@media (prefers-color-scheme: light) {
  :root { --bg-base: #f7f8fc; --text-primary: #0b1220; --text-secondary: rgba(11,18,32,.8); --text-tertiary: rgba(11,18,32,.6); }
}

/* ================================================
   IONICON STYLING - PREMIUM iOS DESIGN
================================================ */

/* Base Ionicon styling */
ion-icon {
  vertical-align: middle;
  display: inline-flex;
  color: inherit;
}

/* Header Ionicons - Large and prominent */
.logo ion-icon,
.header-actions ion-icon,
.app-header ion-icon {
  font-size: 2.2rem;
  vertical-align: middle;
}

/* Bottom Dock Ionicons */
.bottom-dock ion-icon,
.dock-btn ion-icon {
  font-size: 1.6rem;
  margin-right: 0.25rem;
  margin-left: 0.05rem;
  vertical-align: middle;
}

/* Stats Panel Ionicons - Bold and clear */
.stat-box ion-icon {
  font-size: 2.5rem;
  margin-bottom: 12px;
  display: block;
  color: var(--color-primary);
}

/* Main action buttons, timer, and chat buttons */
button ion-icon,
.btn-primary ion-icon,
.btn-timer ion-icon,
.btn-send-chat ion-icon {
  font-size: 1.5rem;
  vertical-align: middle;
}

/* Ensure buttons have proper sizing for tap targets */
.dock-btn,
.btn-primary,
.btn-timer {
  min-width: 48px;
  min-height: 48px;
  display: inline-flex;
  justify-content: center;
  align-items: center;
}

/* Floating header sizing & compaction */
.app-header {
  position: fixed;
  top: var(--space-md);
  left: var(--space-md);
  right: var(--space-md);
  height: var(--header-height);
  z-index: 900;
}

.header-wrapper { display:flex; align-items:center; justify-content:space-between; gap: var(--space-md); }
.header-actions { display:flex; align-items:center; gap: var(--space-sm); }
.header-control { min-width: 40px; min-height: 40px; border-radius: 12px; }

/* Main padding ensures no overlap with header & dock */
.app-main { padding: calc(var(--header-height) + var(--space-xl)) var(--space-md) calc(var(--dock-height) + var(--space-xl)); }

/* Glass surface utility */
.glass-surface {
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shadow);
  border-radius: 18px;
}

/* Bottom dock stabilization */
.bottom-dock {
  position: fixed;
  left: 0; right: 0;
  bottom: max(0px, var(--dock-safe-bottom));
  z-index: 1000;
  height: calc(var(--dock-height) + var(--dock-safe-bottom));
  padding-bottom: var(--dock-safe-bottom);
  display: flex; align-items: center; justify-content: center;
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  border-top: 1px solid var(--glass-border);
  box-shadow: 0 -8px 24px rgba(0,0,0,0.25);
  /* Prevent layout shift when safe-area changes */
  contain: layout paint;
}

.bottom-dock .dock-inner { display:flex; gap: var(--space-md); padding: var(--space-sm) var(--space-md); background: rgba(255,255,255,0.06); border: 1px solid var(--glass-border); border-radius: 18px; }

/* Prevent reflow on hover: promote buttons to their own layer */
.dock-btn, .button, button, .btn { will-change: transform; transform: translateZ(0); backface-visibility: hidden; }
.button, button, .btn { position: relative; transition: transform var(--transition-med), background-color var(--transition-med), box-shadow var(--transition-med); }
.button:hover, button:hover, .btn:hover, .dock-btn:hover { transform: translateY(-1px); }
.button:active, button:active, .btn:active, .dock-btn:active { transform: translateY(0); }
.button:focus-visible, button:focus-visible, .btn:focus-visible, .dock-btn:focus-visible { outline: 2px solid color-mix(in srgb, var(--color-primary) 60%, white); outline-offset: 2px; border-radius: 12px; }

/* Dock active indicator (pop-in) */
.dock-btn { position: relative; display:inline-flex; align-items:center; gap: .5rem; padding: .6rem .9rem; border-radius: 12px; color: var(--text-primary); background: transparent; border: 0; }
.dock-btn .indicator { position:absolute; bottom:6px; left:50%; width:90%; height:4px; background-color: var(--color-secondary); border-radius:2px; opacity:0; transform: translateX(-50%) scaleX(.5); transition: opacity .2s ease, transform .2s ease; }
.dock-btn.active-tab .indicator, .dock-btn[aria-selected="true"] .indicator { opacity:1; transform: translateX(-50%) scaleX(1); }
.dock-name { display:inline-block; font-size:.9rem; }

/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
}

/* Class-based overrides to force reduced motion and transparency when toggled in app */
.reduce-motion * { animation: none !important; transition: none !important; }
.reduce-transparency, .high-contrast-surface { backdrop-filter: none !important; -webkit-backdrop-filter: none !important; background: #0b1220 !important; border-color: rgba(255,255,255,0.24) !important; }

/* Accessibility patches */
.hidden-visually { position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
:focus-visible { outline: 2px solid #9db4ff; outline-offset: 2px; }

/* Skeleton shimmer safety (no layout shift) */
.skeleton { position: relative; overflow: hidden; background: rgba(255,255,255,0.06); }
.skeleton::after { content: ""; position: absolute; inset: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent); transform: translateX(-100%); animation: skeletonFlow 1.2s infinite; }
@keyframes skeletonFlow { to { transform: translateX(100%); } }

/* Mobile layout compression and chat height */
@media (max-width: 768px) {
  :root { --dock-height: 64px; --header-height: 60px; }
  .app-header { top: var(--space-sm); left: var(--space-sm); right: var(--space-sm); height: var(--header-height); }
  .app-main { padding: calc(var(--header-height) + var(--space-lg)) var(--space-sm) calc(var(--dock-height) + var(--space-lg)); }
  .chat-panel, .chat-window, .chat-messages { max-height: calc(100dvh - var(--header-height) - var(--dock-height) - var(--space-lg)); overflow: auto; overscroll-behavior: contain; }
  .flashcards-grid { grid-template-columns: 1fr; }
  .stats-container { grid-template-columns: repeat(2, 1fr); }
  .timer-visual { width: 260px; height: 260px; }
  .timer-text { font-size: 2.6rem; }
}

/* Wide-screen Bento grid tweaks */
@media (min-width: 1200px) {
  .stats-container { grid-template-columns: repeat(4, 1fr); }
  .stats-container .stat-box:nth-child(1) { grid-column: span 2; }
  .stats-container .stat-box:nth-child(2) { grid-row: span 2; }
}

/* Chat area basics */
.chat-panel { display:flex; flex-direction:column; gap: var(--space-md); padding: var(--space-md); }
.chat-top { display:flex; align-items:center; justify-content:space-between; gap: var(--space-sm); }
.chat-messages { display:flex; flex-direction:column; gap: var(--space-md); overflow:auto; }
.chat-bottom { display:flex; gap: var(--space-sm); align-items:flex-end; }
.chat-textarea { width:100%; resize:vertical; min-height: 44px; border-radius: 12px; }
.btn-send-chat { min-width:48px; min-height:44px; border-radius:12px; }

/* Panels common spacing */
.view-header { display:flex; align-items:center; justify-content:space-between; gap: var(--space-md); }
.generator-panel, .tasks-wrapper, .timer-panel { padding: var(--space-md); }

/* Timer visuals */
.timer-svg { width: 100%; height: auto; }
.timer-track { stroke: rgba(255,255,255,0.1); stroke-width: 12; fill: none; }
.timer-path { stroke: var(--color-primary); stroke-width: 12; fill: none; stroke-linecap: round; transition: stroke-dashoffset var(--transition-slow); }

/* ARIA state helpers for focus within */
[role="tab"][aria-selected="true"], .active-tab { background: rgba(255,255,255,0.08); }
[role="dialog"][aria-modal="true"]:focus { outline: none; }

/* Ensure no layout shift when virtual keyboard appears */
@supports (height: 100dvh) {
  .app-main { min-height: calc(100dvh - var(--header-height) - var(--dock-height)); }
}
